From 38bdf8e956218dd6a72942229cf39ef8e45dd28f Mon Sep 17 00:00:00 2001
From: Mike Gorse <mgorse@alum.wpi.edu>
Date: Thu, 2 May 2019 10:54:43 -0500
Subject: [PATCH] cr_utils_read_char_from_utf8_buf: move past invalid UTF-8
Reply-To: muislam@microsoft.com; Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: 8bit

Otherwise, the offending character is never consumed, possibly leading
to an infinite loop.

https://bugzilla.gnome.org/show_bug.cgi?id=782647

CVE: CVE-2017-8834 CVE-2017-8871

Upstream-Status: Backport

Signed-off-by: Muminul Islam <muislam@microsoft.com>

Upstream commit: https://bug782647.bugzilla-attachments.gnome.org/attachment.cgi?id=374219
---
 src/cr-utils.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/cr-utils.c b/src/cr-utils.c
index 2420cec..6cf4849 100644
--- a/src/cr-utils.c
+++ b/src/cr-utils.c
@@ -505,6 +505,7 @@ cr_utils_read_char_from_utf8_buf (const guchar * a_in,
 
         } else {
                 /*BAD ENCODING */
+                nb_bytes_2_decode = 1;
                 goto end;
         }
 
-- 
2.23.0

